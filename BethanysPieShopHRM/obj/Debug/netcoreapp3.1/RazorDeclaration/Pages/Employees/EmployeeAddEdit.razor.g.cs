#pragma checksum "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\Pages\Employees\EmployeeAddEdit.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "67b1808ffd3415f6194f81c8b1823dc5c77d3db1"
// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace BethanysPieShopHRM.Pages.Employees
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using BethanysPieShopHRM;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using BethanysPieShopHRM.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using Microsoft.EntityFrameworkCore;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using BethanysPieShopHRM.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\_Imports.razor"
using BethanysPieShopHRM.Infrastructure;

#line default
#line hidden
#nullable disable
    public partial class EmployeeAddEdit : OwningComponentBase<ApplicationDbContext>
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 182 "C:\Users\k.salahshoor\Desktop\BethanysPieShopHRM\BethanysPieShopHRM\Pages\Employees\EmployeeAddEdit.razor"
       
    ApplicationDbContext _db => Service;
    [Inject] public IJSRuntime _js { get; set; }

    [Parameter] public EventCallback CloseEventCallback { get; set; }

    private SeverSideValidationSummary _severSideValidationSummary;

    public Employee _model { get; set; } = new Employee();

    public List<Country> _countries { get; set; } = new List<Country>();
    protected string _selectedCountryId { get; set; }

    public List<JobCategory> _jobCategories { get; set; } = new List<JobCategory>();
    protected string _selectedJobCategoryId { get; set; }

    protected Gender _gender { get; set; }

    protected SaveModel _saveModel { get; set; } = new SaveModel();

    private bool _show;

    protected override async Task OnInitializedAsync()
    {
        _saveModel.IsSaved = false;

        _countries = await _db.Countries.ToListAsync();
        _jobCategories = await _db.JobCategories.ToListAsync();
    }

    protected async Task handleValidSubmit()
    {
        // serverside validation
        _severSideValidationSummary.ClearErrors();

        var errors = new Dictionary<string, List<string>>();

        //if (true)//some logic
        //{
        //    errors.Add(nameof(_model.FirstName),
        //        new List<string>() { "For a 'Defense' ship classification, Description' is required." });
        //}

        if (errors.Count() > 0)
        {
            _severSideValidationSummary.DisplayErrors(errors);
        }
        else
        {
            // Process the form

            int saveResult = 0;

            _model.CountryId = int.Parse(_selectedCountryId);
            _model.JobCategoryId = int.Parse(_selectedJobCategoryId);

            if (_model.EmployeeId == 0) //create
            {
                _db.Employees.Add(_model);
            }
            else //edit
            {
                var modelFromDb = await _db.Employees.SingleOrDefaultAsync(x => x.EmployeeId == _model.EmployeeId);

                modelFromDb.BirthDate = _model.BirthDate;
                modelFromDb.City = _model.City;
                modelFromDb.Comment = _model.Comment;
                modelFromDb.CountryId = _model.CountryId;
                modelFromDb.Email = _model.Email;
                modelFromDb.ExitDate = _model.ExitDate;
                modelFromDb.FirstName = _model.FirstName;
                modelFromDb.Gender = _model.Gender;
                modelFromDb.JobCategoryId = _model.JobCategoryId;
                modelFromDb.JoinedDate = _model.JoinedDate;
                modelFromDb.LastName = _model.LastName;
                modelFromDb.Latitude = _model.Latitude;
                modelFromDb.Longitude = _model.Longitude;
                modelFromDb.MaritalStatus = _model.MaritalStatus;
                modelFromDb.PhoneNumber = _model.PhoneNumber;
                modelFromDb.Smoker = _model.Smoker;
                modelFromDb.Street = _model.Street;
                modelFromDb.Zip = _model.Zip;

                _db.Employees.Update(modelFromDb);
            }

            try
            {
                saveResult = await _db.SaveChangesAsync();

                if (saveResult == 0)
                {
                    await _js.InvokeVoidAsync("alert", "No Data Saved!!!");
                }
                else
                {
                    await _js.InvokeVoidAsync("alert", "Saved!");
                }

                await CloseEventCallback.InvokeAsync(null);

                _show = false;
                StateHasChanged();
            }
            catch (Exception)
            {
                await _js.InvokeVoidAsync("alert", "Error Saving Data!!!");
            }
        }
    }

    public void Show(Employee model)
    {
        if (model == null)
        {
            _model = new Employee { CountryId = 1, JobCategoryId = 1, BirthDate = DateTime.Now };
        }
        else
        {
            _model = model;
        }

        _selectedCountryId = _model.CountryId.ToString();
        _selectedJobCategoryId = _model.JobCategoryId.ToString();

        _show = true;
        StateHasChanged();
    }
    private void close()
    {
        _show = false;
        StateHasChanged();
    }

#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
